<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Redirect Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-link {
            display: block;
            margin: 10px 0;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
            text-decoration: none;
            color: #16A34A;
            border: 1px solid #dee2e6;
        }
        .test-link:hover {
            background: #e9ecef;
        }
        .expected {
            font-size: 0.9em;
            color: #6c757d;
            margin-left: 20px;
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #16A34A;
            padding-bottom: 10px;
        }
        .section {
            margin: 30px 0;
        }
    </style>
</head>
<body>
    <h1>API Redirect Test Page</h1>
    
    <p>This page tests the dynamic API redirect functionality. Click any link below to test the redirect mapping from old API URLs to new documentation paths.</p>

    <div class="section">
        <h2>Tag-only Redirects</h2>
        <a href="#tag/Fiat-Transfers" class="test-link">
            #tag/Fiat-Transfers
            <div class="expected">→ /api-reference/endpoints/fiat-transfers</div>
        </a>
        
        <a href="#tag/Identity" class="test-link">
            #tag/Identity
            <div class="expected">→ /api-reference/endpoints/identity</div>
        </a>
        
        <a href="#tag/Transfers" class="test-link">
            #tag/Transfers
            <div class="expected">→ /api-reference/endpoints/transfers</div>
        </a>
    </div>

    <div class="section">
        <h2>Tag + Operation Redirects</h2>
        <a href="#tag/Fiat-Transfers/operation/ListFiatAccounts" class="test-link">
            #tag/Fiat-Transfers/operation/ListFiatAccounts
            <div class="expected">→ /api-reference/endpoints/fiat-transfers/list-fiat-accounts</div>
        </a>
        
        <a href="#tag/Identity/operation/CreateIdentity" class="test-link">
            #tag/Identity/operation/CreateIdentity
            <div class="expected">→ /api-reference/endpoints/identity/create-identity</div>
        </a>
        
        <a href="#tag/Transfers/operation/ListTransfers" class="test-link">
            #tag/Transfers/operation/ListTransfers
            <div class="expected">→ /api-reference/endpoints/transfers/list-transfers</div>
        </a>
        
        <a href="#tag/Deposit-Addresses/operation/CreateDepositAddress" class="test-link">
            #tag/Deposit-Addresses/operation/CreateDepositAddress
            <div class="expected">→ /api-reference/endpoints/deposit-addresses/create-deposit-address</div>
        </a>
        
        <a href="#tag/Settlement/operation/CreateTransaction" class="test-link">
            #tag/Settlement/operation/CreateTransaction
            <div class="expected">→ /api-reference/endpoints/settlement/create-transaction</div>
        </a>
        
        <a href="#tag/Stablecoin-Conversion/operation/CreateStablecoinConversion" class="test-link">
            #tag/Stablecoin-Conversion/operation/CreateStablecoinConversion
            <div class="expected">→ /api-reference/endpoints/stablecoin-conversion/create-stablecoin-conversion</div>
        </a>
    </div>

    <div class="section">
        <h2>Complex Operations</h2>
        <a href="#tag/Profiles/operation/ListProfileBalances" class="test-link">
            #tag/Profiles/operation/ListProfileBalances
            <div class="expected">→ /api-reference/endpoints/profiles/list-profile-balances</div>
        </a>
        
        <a href="#tag/Market-Data/operation/GetOrderBook" class="test-link">
            #tag/Market-Data/operation/GetOrderBook
            <div class="expected">→ /api-reference/endpoints/market-data/get-order-book</div>
        </a>
        
        <a href="#tag/Sandbox-Identity/operation/SandboxSetIdentityStatus" class="test-link">
            #tag/Sandbox-Identity/operation/SandboxSetIdentityStatus
            <div class="expected">→ /api-reference/endpoints/sandbox-identity/sandbox-set-identity-status</div>
        </a>
    </div>

    <div class="section">
        <h2>Manual Testing</h2>
        <p>You can also manually test by changing the URL fragment in your browser:</p>
        <code>http://localhost:3000/test-redirect.html#tag/Fiat-Transfers/operation/ListFiatAccounts</code>
        
        <button onclick="testRedirect()">Test Manual Fragment</button>
        <div id="result"></div>
    </div>

    <script src="/api-redirect-interceptor.js"></script>
    <script>
        // Add click tracking to see what gets redirected where
        document.querySelectorAll('.test-link').forEach(link => {
            link.addEventListener('click', (e) => {
                console.log('Testing redirect for:', e.target.href);
            });
        });

        function testRedirect() {
            const tests = [
                'tag/Fiat-Transfers/operation/ListFiatAccounts',
                'tag/Identity/operation/CreateIdentity', 
                'tag/Stablecoin-Conversion/operation/CreateStablecoinConversion',
                'tag/Market-Data/operation/GetOrderBook',
                'tag/Fiat-Transfers',
                'tag/Identity'
            ];
            
            let results = '<h4>Transformation Tests:</h4>';
            
            tests.forEach(test => {
                // Simulate the transformation without actually redirecting
                if (window.transformTag && window.transformOperation) {
                    const tagMatch = test.match(/tag\/([^\/]+)/);
                    const operationMatch = test.match(/operation\/([^\/\?&#]+)/);
                    
                    if (tagMatch) {
                        const tag = tagMatch[1];
                        const operation = operationMatch ? operationMatch[1] : null;
                        
                        const transformedTag = window.transformTag(tag);
                        let targetUrl = `/api-reference/endpoints/${transformedTag}`;
                        
                        if (operation) {
                            const transformedOperation = window.transformOperation(operation);
                            targetUrl += `/${transformedOperation}`;
                        }
                        
                        results += `<p><code>${test}</code><br>→ <code>${targetUrl}</code></p>`;
                    }
                }
            });
            
            document.getElementById('result').innerHTML = results;
        }
    </script>
</body>
</html>